<!DOCTYPE html>
<html lang="en">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>Capy CafÃ© - A cozy chill animal game</title>
Â  Â  <link href="https://fonts.googleapis.com/css2?family=Mali:wght@400;700&display=swap" rel="stylesheet">
Â  Â  <style>
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  background-color: #e0f7fa;Â 
Â  Â  Â  Â  Â  Â  font-family: 'Mali', 'Arial', sans-serif;Â 
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  height: 100vh;
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  Â  Â  padding: 20px;Â 
Â  Â  Â  Â  Â  Â  box-sizing: border-box;
Â  Â  Â  Â  Â  Â  overflow-y: auto;
Â  Â  Â  Â  }

Â  Â  Â  Â  #game-container {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  background-color: #b3e5fc;
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  Â  Â  border-radius: 20px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
Â  Â  Â  Â  Â  Â  max-width: 600px;
Â  Â  Â  Â  Â  Â  max-height: 100%;Â 
Â  Â  Â  Â  Â  Â  overflow-y: visible;
Â  Â  Â  Â  }

Â  Â  Â  Â  #game-title {
Â  Â  Â  Â  Â  Â  font-size: 2.2em;
Â  Â  Â  Â  Â  Â  font-weight: 800;
Â  Â  Â  Â  Â  Â  color: #01579b;
Â  Â  Â  Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  Â  Â  Â  text-shadow: 2px 2px 3px rgba(255, 255, 255, 0.8);
Â  Â  Â  Â  }

Â  Â  Â  Â  #cafe {
Â  Â  Â  Â  Â  Â  display: grid;
Â  Â  Â  Â  Â  Â  border: 6px solid #01579b;
Â  Â  Â  Â  Â  Â  background-color: #81d4fa;
Â  Â  Â  Â  Â  Â  border-radius: 10px;
Â  Â  Â  Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  Â  Â  Â  box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.15);
Â  Â  Â  Â  }

Â  Â  Â  Â  .tile {
Â  Â  Â  Â  Â  Â  width: 45px;
Â  Â  Â  Â  Â  Â  height: 45px;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  box-sizing: border-box;
Â  Â  Â  Â  Â  Â  font-size: 1.5em;
Â  Â  Â  Â  Â  Â  position: relative;Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Floor Tiles */
Â  Â  Â  Â  .tile-F { background-color: #b3e5fc; }Â 
Â  Â  Â  Â  .tile-W { background-color: #0288d1; border: 1px solid #01579b; }Â 

Â  Â  Â  Â  /* Player - Capy Chef Emoji */
Â  Â  Â  Â  .capy-player {
Â  Â  Â  Â  Â  Â  /* Capy size adjusted */
Â  Â  Â  Â  Â  Â  font-size: 1.8em;Â 
Â  Â  Â  Â  Â  Â  line-height: 1;
Â  Â  Â  Â  Â  Â  white-space: nowrap;Â 
Â  Â  Â  Â  Â  Â  z-index: 10;Â 
Â  Â  Â  Â  Â  Â  position: relative;Â 
Â  Â  Â  Â  Â  Â  animation: move-capy 0.5s infinite alternate;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* NPC (Customers) */
Â  Â  Â  Â  .capy-customer {Â 
Â  Â  Â  Â  Â  Â  background-color: transparent;Â 
Â  Â  Â  Â  Â  Â  font-size: 2.5em;Â 
Â  Â  Â  Â  Â  Â  line-height: 1;Â 
Â  Â  Â  Â  Â  Â  z-index: 5;Â 
Â  Â  Â  Â  Â  Â  position: relative;Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Cute Furniture Tiles */
Â  Â  Â  Â  .tile-T { background-color: #64b5f6; border: 3px solid #1976d2; border-radius: 8px; color: white; font-weight: bold; }Â 
Â  Â  Â  Â  .tile-C { background-color: #ffb74d; border: 2px solid #ff9800; border-radius: 50%; }Â 
Â  Â  Â  Â  .tile-S { background-color: #90a4ae; border: 3px solid #607d8b; border-radius: 5px; }Â 
Â  Â  Â  Â  .tile-P { background-color: #4db6ac; border: 3px solid #00897b; border-radius: 5px; }Â 
Â  Â  Â  Â  .tile-L { background-color: #1a237e; border: 3px solid #0d47a1; color: white; font-weight: bold; }Â 
Â  Â  Â  Â  .tile-I { background-color: #795548; border: 3px solid #5d4037; border-radius: 5px; color: white; }Â 
Â  Â  Â  Â  .tile-B { background-color: #00e5ff; border: 3px solid #00b8d4; border-radius: 5px; color: #1a237e; font-weight: bold; }Â 

Â  Â  Â  Â  @keyframes move-capy {
Â  Â  Â  Â  Â  Â  from { transform: translateY(0px); }
Â  Â  Â  Â  Â  Â  to { transform: translateY(-3px); }
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Panels and UI */
Â  Â  Â  Â  .panel {
Â  Â  Â  Â  Â  Â  background-color: white;
Â  Â  Â  Â  Â  Â  padding: 15px;
Â  Â  Â  Â  Â  Â  border-radius: 15px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
Â  Â  Â  Â  Â  Â  margin-top: 15px;
Â  Â  Â  Â  Â  Â  border: 2px solid #01579b;
Â  Â  Â  Â  }
Â  Â  Â  Â  .panel-header {
Â  Â  Â  Â  Â  Â  color: #01579b;
Â  Â  Â  Â  Â  Â  border-bottom: 3px solid #01579b;
Â  Â  Â  Â  Â  Â  padding-bottom: 5px;
Â  Â  Â  Â  Â  Â  margin-top: 0;
Â  Â  Â  Â  }

Â  Â  Â  Â  #inventory-panel {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  padding: 10px 15px;
Â  Â  Â  Â  Â  Â  text-align: left;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  #inventory-list {
Â  Â  Â  Â  Â  Â  list-style: none;
Â  Â  Â  Â  Â  Â  padding: 0;
Â  Â  Â  Â  Â  Â  margin: 5px 0 0 0;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-wrap: wrap;
Â  Â  Â  Â  Â  Â  gap: 15px 25px;
Â  Â  Â  Â  Â  Â  font-weight: 500;
Â  Â  Â  Â  Â  Â  color: #004d40;
Â  Â  Â  Â  }

Â  Â  Â  Â  #interaction-panel {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  max-width: 500px;
Â  Â  Â  Â  Â  Â  min-height: 120px;
Â  Â  Â  Â  Â  Â  border: 4px solid #01579b;
Â  Â  Â  Â  Â  Â  background-color: #e3f2fd;
Â  Â  Â  Â  Â  Â  padding: 15px;
Â  Â  Â  Â  Â  Â  border-radius: 15px;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  }

Â  Â  Â  Â  #dialogue-box {
Â  Â  Â  Â  Â  Â  min-height: 40px;
Â  Â  Â  Â  Â  Â  color: #004d40;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  Â  Â  margin-bottom: 10px;
Â  Â  Â  Â  }

Â  Â  Â  Â  #action-buttons button {
Â  Â  Â  Â  Â  Â  margin: 5px;
Â  Â  Â  Â  Â  Â  padding: 10px 20px;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  border-radius: 10px;
Â  Â  Â  Â  Â  Â  background-color: #00bcd4;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  transition: background-color 0.2s;
Â  Â  Â  Â  }

Â  Â  Â  Â  #action-buttons button:disabled {
Â  Â  Â  Â  Â  Â  background-color: #b0bec5;
Â  Â  Â  Â  Â  Â  cursor: not-allowed;
Â  Â  Â  Â  }

Â  Â  Â  Â  #action-buttons button:hover:not(:disabled) {
Â  Â  Â  Â  Â  Â  background-color: #0097a7;
Â  Â  Â  Â  }

Â  Â  Â  Â  #how-to-play {
Â  Â  Â  Â  Â  Â  position: fixed;Â 
Â  Â  Â  Â  Â  Â  top: 50%;
Â  Â  Â  Â  Â  Â  left: 50%;
Â  Â  Â  Â  Â  Â  transform: translate(-50%, -50%);
Â  Â  Â  Â  Â  Â  width: 80%;
Â  Â  Â  Â  Â  Â  max-width: 400px;
Â  Â  Â  Â  Â  Â  max-height: 90vh;Â 
Â  Â  Â  Â  Â  Â  overflow-y: auto;
Â  Â  Â  Â  Â  Â  z-index: 100;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  border: 5px solid #01579b;
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>

<div id="game-container">
Â  Â  <div id="game-title">Capy CafÃ© - A cozy chill animal game</div>
Â  Â Â 
Â  Â  <div id="inventory-panel" class="panel">
Â  Â  Â  Â  <h3 class="panel-header">ğŸ“ Inventory & Status</h3>
Â  Â  Â  Â  <ul id="inventory-list">
Â  Â  Â  Â  Â  Â  <li>ğŸ’° Coins: <span id="coins">50</span></li>
Â  Â  Â  Â  Â  Â  <li>â¬†ï¸ Floor: <span id="current-floor">1</span></li>
Â  Â  Â  Â  </ul>
        
        <button id="music-toggle" onclick="toggleMusic()">Play Music ğŸµ</button>
        
Â  Â  Â  Â  <div style="margin-top: 10px; border-top: 1px dashed #ccc; padding-top: 5px;">
Â  Â  Â  Â  Â  Â  <p style="font-size: 0.9em; margin: 0; font-weight: bold; color: #00897b;">Ready to Serve:</p>
Â  Â  Â  Â  Â  Â  <div id="cooked-food-display" style="font-size: 0.9em;"></div>
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  Â Â 
Â  Â  <div id="cafe">
Â  Â  Â  Â  </div>

Â  Â  <div id="interaction-panel">
Â  Â  Â  Â  <div id="dialogue-box">Move around. Press **SPACE/ENTER** to interact with Stations, press **U** (or **Shift+U**) to use the Lift (â¬†ï¸)!</div>
Â  Â  Â  Â  <div id="action-buttons"></div>
Â  Â  </div>

Â  Â  <div id="how-to-play" class="panel">
Â  Â  Â  Â  <h3 class="panel-header">â„¹ï¸ How to Play</h3>
Â  Â  Â  Â  <p>Use the **WASD or Arrow Keys** to move your Capy Chef.</p>
Â  Â  Â  Â  <p>Press **Spacebar or Enter** to interact with Stations.</p>
Â  Â  Â  Â  <p>Press **U** or **Shift+U** to use the Lift (â¬†ï¸).</p>
Â  Â  Â  Â  <p>The **Stove** (ğŸ”¥) lets you cook recipes you know.</p>
Â  Â  Â  Â  <p>The **Shop** (ğŸ’) lets you buy new recipes!</p>
Â  Â  Â  Â  <button onclick="document.getElementById('how-to-play').style.display='none'">Got it! (Close)</button>
Â  Â  </div>
Â  Â Â 
Â  Â  </div>

<script>
Â  Â  // --- Game State Variables ---
Â  Â  let currentFloor = 1;
Â  Â  let playerPos = { r: 1, c: 1 };
Â  Â  let coins = 50;Â 
Â  Â  let inventory = {
Â  Â  Â  Â  'Flour': 10, 'Milk': 10, 'Eggs': 10, 'Berries': 10, 'Sugar': 10
Â  Â  };
Â  Â  let cookedItems = {};
Â  Â  let customers = [];Â 
Â  Â  let customerIdCounter = 1;

Â  Â  // --- Recipes (10 Starting Recipes) ---
Â  Â  let unlockedRecipes = [
Â  Â  Â  Â  { name: 'Pancake', emoji: 'ğŸ¥', ingredients: { 'Flour': 1, 'Milk': 1, 'Eggs': 1 }, cost: 10, price: 20 },
Â  Â  Â  Â  { name: 'Berry Smoothie', emoji: 'ğŸ¥¤', ingredients: { 'Berries': 2, 'Milk': 1 }, cost: 12, price: 25 },
Â  Â  Â  Â  { name: 'Waffle', emoji: 'ğŸ§‡', ingredients: { 'Flour': 2, 'Eggs': 1 }, cost: 15, price: 30 },
Â  Â  Â  Â  { name: 'Oatmeal', emoji: 'ğŸ¥£', ingredients: { 'Milk': 2, 'Sugar': 1 }, cost: 8, price: 15 },
Â  Â  Â  Â  { name: 'Crepe', emoji: 'ğŸŒ¯', ingredients: { 'Flour': 1, 'Eggs': 2, 'Milk': 1 }, cost: 14, price: 28 },
Â  Â  Â  Â  { name: 'Cookie', emoji: 'ğŸª', ingredients: { 'Flour': 1, 'Sugar': 1 }, cost: 7, price: 14 },
Â  Â  Â  Â  { name: 'Cupcake', emoji: 'ğŸ§', ingredients: { 'Flour': 1, 'Eggs': 1, 'Sugar': 1 }, cost: 13, price: 26 },
Â  Â  Â  Â  { name: 'Tea', emoji: 'â˜•', ingredients: { 'Sugar': 1 }, cost: 5, price: 10 },
Â  Â  Â  Â  { name: 'Toast', emoji: 'ğŸ', ingredients: { 'Flour': 1 }, cost: 6, price: 12 },
Â  Â  Â  Â  { name: 'Muffin', emoji: 'ğŸ©', ingredients: { 'Flour': 2, 'Milk': 1 }, cost: 11, price: 22 },
Â  Â  ];

Â  Â  // --- Unlockable Recipes/Items (For conceptual 200 total) ---
Â  Â  const allUnlockables = [
Â  Â  Â  Â  { type: 'recipe', name: 'Strawberry Cake', emoji: 'ğŸ°', ingredients: { 'Flour': 3, 'Eggs': 2, 'Sugar': 2 }, cost: 30, price: 60 },
Â  Â  Â  Â  { type: 'recipe', name: 'Lemonade', emoji: 'ğŸ‹', ingredients: { 'Sugar': 2 }, cost: 15, price: 30 },
Â  Â  Â  Â  { type: 'ingredient', name: 'Chocolate', emoji: 'ğŸ«', price: 40, quantity: 5, uses: 'Unlocks advanced chocolate recipes' },
Â  Â  ];

Â  Â  let availableUnlockables = allUnlockables;Â 

Â  Â  // --- Cafe Layouts ---
Â  Â  const layouts = {
Â  Â  Â  Â  1: [ // Ground Floor (Kitchen & Dining)
Â  Â  Â  Â  Â  Â  ['W', 'W', 'W', 'W', 'W', 'W', 'W', 'W', 'W', 'W'],
Â  Â  Â  Â  Â  Â  ['W', 'F', 'F', 'F', 'T', 'C', 'F', 'F', 'L', 'W'],
Â  Â  Â  Â  Â  Â  ['W', 'F', 'F', 'F', 'C', 'F', 'F', 'F', 'F', 'W'],
Â  Â  Â  Â  Â  Â  ['W', 'T', 'C', 'F', 'F', 'F', 'F', 'T', 'C', 'W'],
Â  Â  Â  Â  Â  Â  ['W', 'C', 'F', 'F', 'F', 'F', 'F', 'C', 'F', 'W'],
Â  Â  Â  Â  Â  Â  ['W', 'F', 'F', 'F', 'F', 'F', 'F', 'F', 'F', 'W'],
Â  Â  Â  Â  Â  Â  ['W', 'I', 'S', 'S', 'P', 'P', 'F', 'F', 'F', 'W'],
Â  Â  Â  Â  Â  Â  ['W', 'W', 'W', 'W', 'W', 'W', 'W', 'W', 'W', 'W'],
Â  Â  Â  Â  ],
Â  Â  Â  Â  2: [ // Second Floor (Dining & Shop)
Â  Â  Â  Â  Â  Â  ['W', 'W', 'W', 'W', 'W', 'W', 'W', 'W', 'W', 'W'],
Â  Â  Â  Â  Â  Â  ['W', 'L', 'F', 'F', 'T', 'C', 'F', 'F', 'B', 'W'], // B = Shop/Boutique
Â  Â  Â  Â  Â  Â  ['W', 'F', 'F', 'F', 'C', 'F', 'F', 'F', 'F', 'W'],
Â  Â  Â  Â  Â  Â  ['W', 'T', 'C', 'F', 'F', 'F', 'F', 'T', 'C', 'W'],
Â  Â  Â  Â  Â  Â  ['W', 'C', 'F', 'F', 'F', 'F', 'F', 'C', 'F', 'W'],
Â  Â  Â  Â  Â  Â  ['W', 'F', 'F', 'F', 'F', 'F', 'F', 'F', 'F', 'W'],
Â  Â  Â  Â  Â  Â  ['W', 'F', 'F', 'F', 'F', 'F', 'F', 'F', 'F', 'W'],
Â  Â  Â  Â  Â  Â  ['W', 'W', 'W', 'W', 'W', 'W', 'W', 'W', 'W', 'W'],
Â  Â  Â  Â  ]
Â  Â  };

Â  Â  // --- Emojis and Image Data ---
Â  Â  const playerEmoji = 'â‚á¢-(ï½ª)-á¢â‚';Â 
Â  Â Â 
Â  Â  // Grid dimensions declared globally
Â  Â  let numRows = 0;Â 
Â  Â  let numCols = 0;Â 

Â  Â  const visuals = {
Â  Â  Â  Â  'customer_types': ['ğŸ¦™', 'ğŸ‘', 'ğŸ»', 'ğŸ¦Š', 'ğŸ¼'],Â 
Â  Â  Â  Â  'F': ' ',
Â  Â  Â  Â  'W': 'ğŸ§±',
Â  Â  Â  Â  'T': 'ğŸ½ï¸',
Â  Â  Â  Â  'C': 'ğŸª‘',
Â  Â  Â  Â  'S': 'ğŸ”¥',
Â  Â  Â  Â  'P': 'â¡ï¸',
Â  Â  Â  Â  'L': 'â¬†ï¸',
Â  Â  Â  Â  'I': 'ğŸ“¦',
Â  Â  Â  Â  'B': 'ğŸ’' // Shop
Â  Â  };

    // -------------------------------------------------------------------
    // MUSIC JAVASCRIPT INSERTED HERE
    // -------------------------------------------------------------------

    // --- Music/Sound Functions ---
    let isMusicPlaying = false;
    const musicButton = document.getElementById('music-toggle');

    function toggleMusic() {
        const music = document.getElementById('bg-music');
        
        if (isMusicPlaying) {
            music.pause();
            musicButton.textContent = 'Play Music ğŸµ';
            isMusicPlaying = false;
            showMessage("Music paused.");
        } else {
            // Attempt to play music using a Promise to handle browser restrictions
            music.volume = 0.5; 
            music.play().then(() => {
                musicButton.textContent = 'Stop Music ğŸ”‡';
                isMusicPlaying = true;
                showMessage("Cozy Capy music playing!");
            }).catch(error => {
                console.error("Autoplay failed:", error);
                showMessage("Music loading failed. Check the file name in the code.");
            });
        }
    }
    // -----------------------------


Â  Â  // --- Game Logic Functions ---

Â  Â  function updateUI() {
Â  Â  Â  Â  const cafeDiv = document.getElementById('cafe');
Â  Â  Â  Â  const currentLayout = layouts[currentFloor];

Â  Â  Â  Â  if (!currentLayout || currentLayout.length === 0) {
Â  Â  Â  Â  Â  Â  Â console.error("Layout for current floor is undefined or empty.");
Â  Â  Â  Â  Â  Â  Â // Crucial: If layout is broken, prevent further rendering errors.
Â  Â  Â  Â  Â  Â  Â cafeDiv.innerHTML = '<div style="color: red; padding: 20px;">ERROR: Game board layout is missing or corrupted.</div>';
Â  Â  Â  Â  Â  Â  Â return;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  numRows = currentLayout.length;
Â  Â  Â  Â  numCols = currentLayout[0].length;
Â  Â  Â  Â Â 

Â  Â  Â  Â  cafeDiv.style.gridTemplateColumns = `repeat(${numCols}, 1fr)`;
Â  Â  Â  Â Â 
Â  Â  Â  Â  let html = '';

Â  Â  Â  Â  for (let r = 0; r < numRows; r++) {
Â  Â  Â  Â  Â  Â  for (let c = 0; c < numCols; c++) {
Â  Â  Â  Â  Â  Â  Â  Â  const tileType = currentLayout[r][c] || 'W';Â 
Â  Â  Â  Â  Â  Â  Â  Â  let content = visuals[tileType];
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // 1. Check for Customer
Â  Â  Â  Â  Â  Â  Â  Â  const customer = customers.find(cust => cust.r === r && cust.c === c && cust.floor === currentFloor);
Â  Â  Â  Â  Â  Â  Â  Â  if (customer) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  content = `<span class="capy-customer">${customer.emoji}</span>`;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // 2. Check for PlayerÂ 
Â  Â  Â  Â  Â  Â  Â  Â  if (r === playerPos.r && c === playerPos.c) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  content = `<span class="capy-player">${playerEmoji}</span>`;
Â  Â  Â  Â  Â  Â  Â  Â  }Â 

Â  Â  Â  Â  Â  Â  Â  Â  html += `<div id="tile-${r}-${c}" class="tile tile-${tileType}">${content}</div>`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  cafeDiv.innerHTML = html;
Â  Â  Â  Â  updateInventoryDisplay();
Â  Â  Â  Â  document.getElementById('current-floor').textContent = currentFloor;
Â  Â  Â  Â  document.getElementById('coins').textContent = coins;
Â  Â  }

Â  Â  function updateInventoryDisplay() {
Â  Â  Â  Â  let rawHtml = '<ul>';
Â  Â  Â  Â  for (const [item, count] of Object.entries(inventory)) {
Â  Â  Â  Â  Â  Â  rawHtml += `<li>${item}: ${count}</li>`;
Â  Â  Â  Â  }
Â  Â  Â  Â  rawHtml += '</ul>';

Â  Â  Â  Â  let cookedHtml = '';
Â  Â  Â  Â  if (Object.keys(cookedItems).length === 0) {
Â  Â  Â  Â  Â  Â  cookedHtml = 'No dishes ready.';
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  for (const [dish, count] of Object.entries(cookedItems)) {
Â  Â  Â  Â  Â  Â  Â  Â  const recipe = unlockedRecipes.find(r => r.name === dish);
Â  Â  Â  Â  Â  Â  Â  Â  if (recipe) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cookedHtml += `${recipe.emoji} ${dish} x${count} `;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  document.getElementById('inventory-list').innerHTML = `
Â  Â  Â  Â  Â  Â  <li>ğŸ’° Coins: <span id="coins">${coins}</span></li>
Â  Â  Â  Â  Â  Â  <li>â¬†ï¸ Floor: <span id="current-floor">${currentFloor}</span></li>
Â  Â  Â  Â  Â  Â  <li style="margin-top: 10px; width: 100%;">ğŸ“¦ Ingredients: ${rawHtml}</li>
Â  Â  Â  Â  `;
Â  Â  Â  Â  document.getElementById('cooked-food-display').innerHTML = cookedHtml;
Â  Â  }

Â  Â  function tryMove(dr, dc) {
Â  Â  Â  Â  const currentLayout = layouts[currentFloor];
Â  Â  Â  Â  numRows = currentLayout.length;
Â  Â  Â  Â  numCols = currentLayout[0].length;

Â  Â  Â  Â  const newR = playerPos.r + dr;
Â  Â  Â  Â  const newC = playerPos.c + dc;Â 

Â  Â  Â  Â  if (newR >= 0 && newR < numRows && newC >= 0 && newC < numCols) {
Â  Â  Â  Â  Â  Â  const newTile = currentLayout[newR][newC];
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Allow movement onto Floor (F) and Lift (L) tiles
Â  Â  Â  Â  Â  Â  if (newTile === 'F' || newTile === 'L') {
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const customerAtNewPos = customers.some(c => c.r === newR && c.c === newC && c.floor === currentFloor);
Â  Â  Â  Â  Â  Â  Â  Â  if (!customerAtNewPos) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  playerPos.r = newR;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  playerPos.c = newC;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  clearInteraction();
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showMessage("There's a customer standing there!");
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  showMessage(`Press **SPACE/ENTER** to interact with the ${getTileName(newTile)}. Press **U** to use the Lift!`);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  updateUI();
Â  Â  }

Â  Â  function getTileName(tile) {
Â  Â  Â  Â  switch(tile) {
Â  Â  Â  Â  Â  Â  case 'L': return 'Lift (â¬†ï¸)';
Â  Â  Â  Â  Â  Â  case 'S': return 'Stove (ğŸ”¥)';
Â  Â  Â  Â  Â  Â  case 'P': return 'Serving Counter (â¡ï¸)';
Â  Â  Â  Â  Â  Â  case 'I': return 'Ingredient Cupboard (ğŸ“¦)';
Â  Â  Â  Â  Â  Â  case 'B': return 'Shop (ğŸ’)';
Â  Â  Â  Â  Â  Â  case 'T': return 'Table (ğŸ½ï¸)';
Â  Â  Â  Â  Â  Â  case 'C': return 'Chair (ğŸª‘)';
Â  Â  Â  Â  Â  Â  default: return 'object';
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function spawnCustomer() {
Â  Â  Â  Â  // Only spawn customers on Floor 2
Â  Â  Â  Â  if (currentFloor !== 2) return;Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Limit the number of customers
Â  Â  Â  Â  if (customers.length >= 2) return;

Â  Â  Â  Â  const availableSeats = [];
Â  Â  Â  Â  const layout = layouts[2];
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Find available chairs (C) next to a table (T)
Â  Â  Â  Â  for (let r = 0; r < numRows; r++) {
Â  Â  Â  Â  Â  Â  for (let c = 0; c < numCols; c++) {
Â  Â  Â  Â  Â  Â  Â  Â  if (layout[r][c] === 'C') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isOccupied = customers.some(cust => cust.r === r && cust.c === c && cust.floor === 2);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!isOccupied) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const neighbors = [{dr: 0, dc: 1}, {dr: 0, dc: -1}, {dr: 1, dc: 0}, {dr: -1, dc: 0}];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const hasTable = neighbors.some(n => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const nr = r + n.dr;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const nc = c + n.dc;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return nr >= 0 && nr < numRows && nc >= 0 && nc < numCols && layout[nr][nc] === 'T';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (hasTable) availableSeats.push({ r, c });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  if (availableSeats.length > 0) {
Â  Â  Â  Â  Â  Â  const { r, c } = availableSeats[Math.floor(Math.random() * availableSeats.length)];
Â  Â  Â  Â  Â  Â  const randomRecipe = unlockedRecipes[Math.floor(Math.random() * unlockedRecipes.length)];
Â  Â  Â  Â  Â  Â  const randomEmoji = visuals.customer_types[Math.floor(Math.random() * visuals.customer_types.length)];
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  customers.push({
Â  Â  Â  Â  Â  Â  Â  Â  id: customerIdCounter++,
Â  Â  Â  Â  Â  Â  Â  Â  r: r,
Â  Â  Â  Â  Â  Â  Â  Â  c: c,
Â  Â  Â  Â  Â  Â  Â  Â  floor: 2,
Â  Â  Â  Â  Â  Â  Â  Â  emoji: randomEmoji,
Â  Â  Â  Â  Â  Â  Â  Â  order: randomRecipe,
Â  Â  Â  Â  Â  Â  Â  Â  state: 'waiting',Â 
Â  Â  Â  Â  Â  Â  Â  Â  patience: 30Â 
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  showMessage(`A new customer (${randomEmoji}) has arrived on **Floor 2**! Go talk to them (SPACE/ENTER) to take their order.`);
Â  Â  Â  Â  }
Â  Â  Â  Â  updateUI();
Â  Â  }

Â  Â  // --- Interaction Functions ---

Â  Â  function handleInteraction() {
Â  Â  Â  Â  const layout = layouts[currentFloor];
Â  Â  Â  Â  const { r, c } = playerPos;
Â  Â  Â  Â  let interacted = false;

Â  Â  Â  Â  const neighbors = [{dr: 0, dc: 1}, {dr: 0, dc: -1}, {dr: 1, dc: 0}, {dr: -1, dc: 0}];

Â  Â  Â  Â  for (const {dr, dc} of neighbors) {
Â  Â  Â  Â  Â  Â  const ir = r + dr;
Â  Â  Â  Â  Â  Â  const ic = c + dc;

Â  Â  Â  Â  Â  Â  if (ir >= 0 && ir < numRows && ic >= 0 && ic < numCols) {
Â  Â  Â  Â  Â  Â  Â  Â  const tile = layout[ir][ic];
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (tile === 'S') {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  interactStove();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  interacted = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  } else if (tile === 'I') {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  interactIngredients();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  interacted = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  } else if (tile === 'P' && currentFloor === 1) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  interactServingCounter(ir, ic);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  interacted = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  } else if (tile === 'B' && currentFloor === 2) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  interactShop();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  interacted = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  } else if (currentFloor === 2 && (tile === 'C' || tile === 'T')) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const customer = customers.find(cust =>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cust.floor === 2 &&Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  (cust.r === ir && cust.c === ic)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (customer) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  interactCustomer(ir, ic);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  interacted = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  if (!interacted) {
Â  Â  Â  Â  Â  Â  showMessage("Nothing interesting nearby. Press **U** to use the Lift (â¬†ï¸) if you are next to it.");
Â  Â  Â  Â  Â  Â  clearInteraction();
Â  Â  Â  Â  }
Â  Â  Â  Â  updateUI();
Â  Â  }

Â  Â  function checkAndInteractLift() {
Â  Â  Â  Â  const layout = layouts[currentFloor];
Â  Â  Â  Â  const { r, c } = playerPos;

Â  Â  Â  Â  const neighbors = [{dr: 0, dc: 1}, {dr: 0, dc: -1}, {dr: 1, dc: 0}, {dr: -1, dc: 0}];

Â  Â  Â  Â  for (const {dr, dc} of neighbors) {
Â  Â  Â  Â  Â  Â  const ir = r + dr;
Â  Â  Â  Â  Â  Â  const ic = c + dc;

Â  Â  Â  Â  Â  Â  if (ir >= 0 && ir < numRows && ic >= 0 && ic < numCols) {
Â  Â  Â  Â  Â  Â  Â  Â  if (layout[ir][ic] === 'L') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  interactLift();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return true;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  showMessage("You must be standing next to the **Lift (â¬†ï¸)** to use it. (Press U or Shift+U)");
Â  Â  Â  Â  return false;
Â  Â  }

Â  Â  function interactLift() {
Â  Â  Â  Â  clearInteraction();
Â  Â  Â  Â  const newFloor = currentFloor === 1 ? 2 : 1;
Â  Â  Â  Â  showMessage(`Moving to Floor ${newFloor}...`);
Â  Â  Â  Â Â 
Â  Â  Â  Â  let newLiftPos = null;Â 
Â  Â  Â  Â  let newPlayerPos = null;
Â  Â  Â  Â  const destLayout = layouts[newFloor];
Â  Â  Â  Â Â 
Â  Â  Â  Â  const destRows = destLayout.length;
Â  Â  Â  Â  const destCols = destLayout[0].length;

Â  Â  Â  Â  for (let r = 0; r < destRows; r++) {
Â  Â  Â  Â  Â  Â  for (let c = 0; c < destCols; c++) {
Â  Â  Â  Â  Â  Â  Â  Â  // Find the lift location on the destination floor
Â  Â  Â  Â  Â  Â  Â  Â  if (destLayout[r][c] === 'L') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  newLiftPos = {r, c};
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;Â 
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (newLiftPos) break;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (newLiftPos) {
Â  Â  Â  Â  Â  Â  const neighbors = [{dr: 0, dc: 1}, {dr: 0, dc: -1}, {dr: 1, dc: 0}, {dr: -1, dc: 0}];
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Try to find a safe floor tile next to the lift to place the player
Â  Â  Â  Â  Â  Â  for (const {dr, dc} of neighbors) {
Â  Â  Â  Â  Â  Â  Â  Â  const landR = newLiftPos.r + dr;
Â  Â  Â  Â  Â  Â  Â  Â  const landC = newLiftPos.c + dc;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (landR >= 0 && landR < destRows && landC >= 0 && landC < destCols) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (destLayout[landR][landC] === 'F') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  newPlayerPos = {r: landR, c: landC};
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  if (newPlayerPos) {
Â  Â  Â  Â  Â  Â  Â  Â  currentFloor = newFloor;
Â  Â  Â  Â  Â  Â  Â  Â  playerPos.r = newPlayerPos.r;
Â  Â  Â  Â  Â  Â  Â  Â  playerPos.c = newPlayerPos.c;
Â  Â  Â  Â  Â  Â  Â  Â  showMessage(` Welcome to **Floor ${currentFloor}**!`);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // If moving to Floor 2, ensure a customer check happens immediately
Â  Â  Â  Â  Â  Â  Â  Â  if (currentFloor === 2) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  spawnCustomer();
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  showMessage("Lift is accessible but the surrounding area is blocked! (Error: No safe landing spot)");
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  showMessage("Lift is out of order! (Error: Destination lift not found)");
Â  Â  Â  Â  }

Â  Â  Â  Â  updateUI();
Â  Â  }

Â  Â  function interactStove() {
Â  Â  Â  Â  clearInteraction();
Â  Â  Â  Â  showMessage("ğŸ”¥ **COOKING STATION:** What would you like to cook? (Check your raw ingredients!)");
Â  Â  Â  Â Â 
Â  Â  Â  Â  const actionButtons = document.getElementById('action-buttons');

Â  Â  Â  Â  unlockedRecipes.forEach(recipe => {
Â  Â  Â  Â  Â  Â  let canCook = true;
Â  Â  Â  Â  Â  Â  for (const [ing, needed] of Object.entries(recipe.ingredients)) {
Â  Â  Â  Â  Â  Â  Â  Â  if ((inventory[ing] || 0) < needed) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  canCook = false;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const button = document.createElement('button');
Â  Â  Â  Â  Â  Â  button.textContent = `${recipe.emoji} ${recipe.name}`;
Â  Â  Â  Â  Â  Â  button.disabled = !canCook;
Â  Â  Â  Â  Â  Â  if (canCook) {
Â  Â  Â  Â  Â  Â  Â  Â  button.onclick = () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cook(recipe);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  interactStove();Â 
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  actionButtons.appendChild(button);
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  const doneButton = document.createElement('button');
Â  Â  Â  Â  doneButton.textContent = "Done Cooking";
Â  Â  Â  Â  doneButton.onclick = clearInteraction;
Â  Â  Â  Â  actionButtons.appendChild(doneButton);
Â  Â  }

Â  Â  function interactIngredients() {
Â  Â  Â  Â  clearInteraction();
Â  Â  Â  Â  showMessage("ğŸ“¦ **INGREDIENT CUPBOARD:** You can buy more raw ingredients here for 5 coins each.");
Â  Â  Â  Â Â 
Â  Â  Â  Â  const ingredientsToBuy = Object.keys(inventory);
Â  Â  Â  Â  const actionButtons = document.getElementById('action-buttons');

Â  Â  Â  Â  ingredientsToBuy.forEach(ing => {
Â  Â  Â  Â  Â  Â  const button = document.createElement('button');
Â  Â  Â  Â  Â  Â  button.textContent = `Buy 1x ${ing} (5Â¢)`;
Â  Â  Â  Â  Â  Â  button.disabled = coins < 5;
Â  Â  Â  Â  Â  Â  button.onclick = () => buyIngredient(ing);
Â  Â  Â  Â  Â  Â  actionButtons.appendChild(button);
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  const doneButton = document.createElement('button');
Â  Â  Â  Â  doneButton.textContent = "Done";
Â  Â  Â  Â  doneButton.onclick = clearInteraction;
Â  Â  Â  Â  actionButtons.appendChild(doneButton);
Â  Â  }

Â  Â  function interactServingCounter(ir, ic) {
Â  Â  Â  Â  clearInteraction();
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Find the first customer who has placed an order (state 'ordered')
Â  Â  Â  Â  const orderedCustomer = customers.find(cust => cust.state === 'ordered' && cust.floor === 2);

Â  Â  Â  Â  if (!orderedCustomer) {
Â  Â  Â  Â  Â  Â  showMessage("â¡ï¸ **SERVING COUNTER:** The counter is ready, but no customers have placed an order yet. Go to **Floor 2** and interact with a customer first!");
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  const dishName = orderedCustomer.order.name;
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (cookedItems[dishName] && cookedItems[dishName] > 0) {
Â  Â  Â  Â  Â  Â  showMessage(`A customer on Floor 2 is waiting for their **${dishName}**! You have the dish.`);
Â  Â  Â  Â  Â  Â  const serveButton = document.createElement('button');
Â  Â  Â  Â  Â  Â  serveButton.textContent = `Serve 1x ${orderedCustomer.order.emoji} ${dishName}`;
Â  Â  Â  Â  Â  Â  serveButton.onclick = () => serveFood(orderedCustomer);
Â  Â  Â  Â  Â  Â  document.getElementById('action-buttons').appendChild(serveButton);
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  showMessage(`A customer is waiting, but you need to cook a **${dishName}** first at the Stove (ğŸ”¥)!`);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  const doneButton = document.createElement('button');
Â  Â  Â  Â  doneButton.textContent = "Close Counter";
Â  Â  Â  Â  doneButton.onclick = clearInteraction;
Â  Â  Â  Â  document.getElementById('action-buttons').appendChild(doneButton);
Â  Â  }

Â  Â  function interactShop() {
Â  Â  Â  Â  clearInteraction();
Â  Â  Â  Â  showMessage("ğŸ’ **CAPY SHOP:** Welcome! Buy new recipes to expand your menu.");

Â  Â  Â  Â  availableUnlockables.forEach(item => {
Â  Â  Â  Â  Â  Â  const isRecipe = item.type === 'recipe';
Â  Â  Â  Â  Â  Â  const itemEmoji = isRecipe ? item.emoji : item.emoji;
Â  Â  Â  Â  Â  Â  const itemType = isRecipe ? 'Recipe' : 'Ingredient Pack';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let alreadyUnlocked = unlockedRecipes.some(r => r.name === item.name);
Â  Â  Â  Â  Â  Â  let buttonText = `${itemEmoji} ${item.name} (${item.price}Â¢) - ${itemType}`;

Â  Â  Â  Â  Â  Â  const button = document.createElement('button');
Â  Â  Â  Â  Â  Â  button.textContent = alreadyUnlocked ? `${buttonText} (UNLOCKED)` : buttonText;
Â  Â  Â  Â  Â  Â  button.disabled = alreadyUnlocked || coins < item.price;

Â  Â  Â  Â  Â  Â  if (!alreadyUnlocked) {
Â  Â  Â  Â  Â  Â  Â  Â  button.onclick = () => buyUnlockable(item);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  document.getElementById('action-buttons').appendChild(button);
Â  Â  Â  Â  });

Â  Â  Â  Â  const doneButton = document.createElement('button');
Â  Â  Â  Â  doneButton.textContent = "Done Shopping";
Â  Â  Â  Â  doneButton.onclick = clearInteraction;
Â  Â  Â  Â  document.getElementById('action-buttons').appendChild(doneButton);
Â  Â  }

Â  Â  function interactCustomer(ir, ic) {
Â  Â  Â  Â  const customer = customers.find(cust => cust.r === ir && cust.c === ic && cust.floor === 2);

Â  Â  Â  Â  if (customer && customer.state === 'waiting') {
Â  Â  Â  Â  Â  Â  clearInteraction();
Â  Â  Â  Â  Â  Â  showMessage(`${customer.emoji}: "Hello! Could I please get a **${customer.order.name}**?" (Order Taken!)`);
Â  Â  Â  Â  Â  Â  customer.state = 'ordered';Â 
Â  Â  Â  Â  Â  Â  updateUI();
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Guide player to the next step
Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  showMessage(`Go to **Floor 1 (Kitchen)** to cook the **${customer.order.name}** and serve it at the Counter (â¡ï¸)!`);
Â  Â  Â  Â  Â  Â  }, 100);

Â  Â  Â  Â  } else if (customer && customer.state === 'ordered') {
Â  Â  Â  Â  Â  Â  showMessage(`${customer.emoji}: "I'm still waiting for my **${customer.order.name}**... (Patience: ${Math.max(0, customer.patience)}). Hurry!`);
Â  Â  Â  Â  } else if (customer && customer.state === 'eating') {
Â  Â  Â  Â  Â  Â  showMessage(`${customer.emoji}: "This is great! Just a little longer..."`);
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  showMessage("I think that spot is empty now.");
Â  Â  Â  Â  }
Â  Â  }
Â  Â Â 
Â  Â  // --- Cooking and Inventory Functions ---

Â  Â  function cook(recipe) {
Â  Â  Â  Â  for (const [ing, needed] of Object.entries(recipe.ingredients)) {
Â  Â  Â  Â  Â  Â  inventory[ing] -= needed;
Â  Â  Â  Â  }

Â  Â  Â  Â  cookedItems[recipe.name] = (cookedItems[recipe.name] || 0) + 1;
Â  Â  Â  Â Â 
Â  Â  Â  Â  showMessage(`You cooked one ${recipe.emoji} **${recipe.name}**! It's ready to serve. Go to the Counter (â¡ï¸).`);
Â  Â  Â  Â  updateUI();
Â  Â  }

Â  Â  function buyIngredient(ing) {
Â  Â  Â  Â  if (coins >= 5) {
Â  Â  Â  Â  Â  Â  coins -= 5;
Â  Â  Â  Â  Â  Â  inventory[ing] = (inventory[ing] || 0) + 1;
Â  Â  Â  Â  Â  Â  showMessage(`Bought 1x **${ing}** for 5 coins.`);
Â  Â  Â  Â  Â  Â  clearInteraction();
Â  Â  Â  Â  Â  Â  interactIngredients();Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  updateUI();
Â  Â  }

Â  Â  function buyUnlockable(item) {
Â  Â  Â  Â  if (coins < item.price) {
Â  Â  Â  Â  Â  Â  showMessage("You don't have enough coins!");
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  coins -= item.price;

Â  Â  Â  Â  if (item.type === 'recipe') {
Â  Â  Â  Â  Â  Â  unlockedRecipes.push(item);
Â  Â  Â  Â  Â  Â  availableUnlockables = availableUnlockables.filter(u => u.name !== item.name);
Â  Â  Â  Â  Â  Â  showMessage(`New recipe **${item.name}** unlocked!`);
Â  Â  Â  Â  } else if (item.type === 'ingredient') {
Â  Â  Â  Â  Â  Â  inventory[item.name] = (inventory[item.name] || 0) + item.quantity;
Â  Â  Â  Â  Â  Â  availableUnlockables = availableUnlockables.filter(u => u.name !== item.name);
Â  Â  Â  Â  Â  Â  showMessage(`Received **${item.quantity}x ${item.name}**!`);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  clearInteraction();
Â  Â  Â  Â  interactShop();Â 
Â  Â  }

Â  Â  function serveFood(customer) {
Â  Â  Â  Â  const dishName = customer.order.name;
Â  Â  Â  Â  const price = customer.order.price || 10;Â 

Â  Â  Â  Â  cookedItems[dishName] -= 1;
Â  Â  Â  Â  if (cookedItems[dishName] === 0) {
Â  Â  Â  Â  Â  Â  delete cookedItems[dishName];
Â  Â  Â  Â  }

Â  Â  Â  Â  coins += price;
Â  Â  Â  Â Â 
Â  Â  Â  Â  showMessage(`Served the **${dishName}** to ${customer.emoji}! Earned **${price} coins**! Now go to Floor 2 to talk to them to get them to leave!`);
Â  Â  Â  Â Â 
Â  Â  Â  Â  customer.state = 'eating';
Â  Â  Â  Â  customer.patience = 10; // 10 ticks for eating time (30 seconds real time)
Â  Â  Â  Â Â 
Â  Â  Â  Â  clearInteraction();
Â  Â  Â  Â  updateUI();
Â  Â  }

Â  Â  function customerTick() {
Â  Â  Â  Â  customers = customers.filter(customer => {
Â  Â  Â  Â  Â  Â  if (customer.floor === 2) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  customer.patience--;

Â  Â  Â  Â  Â  Â  Â  Â  if (customer.state === 'ordered' && customer.patience <= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showMessage(`${customer.emoji} got tired of waiting for the **${customer.order.name}** and left! No coins earned. ğŸ˜¢`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return false; // Remove customer
Â  Â  Â  Â  Â  Â  Â  Â  }Â 
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (customer.state === 'eating' && customer.patience <= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showMessage(`${customer.emoji} finished eating and left happily! ğŸ˜Š`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return false; // Remove customer
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  return true; // Keep customer
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Only attempt to spawn if on the right floor and below max
Â  Â  Â  Â  if (currentFloor === 2 && customers.length < 2) {
Â  Â  Â  Â  Â  Â  spawnCustomer();
Â  Â  Â  Â  }

Â  Â  Â  Â  updateUI();
Â  Â  }

Â  Â  // --- Utility Functions ---

Â  Â  function showMessage(message) {
Â  Â  Â  Â  document.getElementById('dialogue-box').innerHTML = message;
Â  Â  }

Â  Â  function clearInteraction() {
Â  Â  Â  Â  document.getElementById('action-buttons').innerHTML = '';
Â  Â  Â  Â  showMessage("Move around. Press **SPACE/ENTER** to interact with Stations, press **U** (or **Shift+U**) to use the Lift (â¬†ï¸)! Customers appear on **Floor 2**.");
Â  Â  }

Â  Â  // --- Game Initialization and Event Listeners ---

Â  Â  function initGame() {
Â  Â  Â  Â  // Set the player to a guaranteed valid Floor tile (1, 1) on the first floor
Â  Â  Â  Â  currentFloor = 1;
Â  Â  Â  Â  playerPos = {r: 1, c: 1};Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (layouts[1].length > 0) {
Â  Â  Â  Â  Â  Â  numRows = layouts[1].length;
Â  Â  Â  Â  Â  Â  numCols = layouts[1][0].length;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  updateUI();Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Initial Message since there's no music prompt
Â  Â  Â  Â  showMessage("Welcome to Capy CafÃ©! You can start playing immediately.");

Â  Â  Â  Â  // Start customer management loop (Runs every 3000ms = 3 seconds)
Â  Â  Â  Â  setInterval(
</script>
Â  Â  </div>

<audio id="bg-music" loop preload="auto">
    <source src="good-night-lofi-cozy-chill-music-160166.mp3" type="audio/mpeg"> 
</audio>

</body>
</html>

</body>
</html>
